{% extends 'base.html' %}
{% from 'macros/_formhelpers.html' import render_field %}
{% block style %}
	<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/post.css') }}" />
	<link rel="stylesheet" href="{{ url_for('comment.static', filename='css/comment.css') }}">
{% endblock %}
{% block scripts %}{% endblock %}

<!-- :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::: -->

{% block content %}
	<section class="columns">
        <aside class="one-fourth column">
           {% include 'components/_nav_publications.html' %}
        </aside>
        <div class="three-fourths column">
			<article class="Box my-3 post">
				<div class="Box-header">
					{% if data.post.author.photo_url %}
						<a class="user-avatar" href="{{ url_for('user.profile_page', username=data.post.author.name) }}">
							<span><img width="33px" src="{{ url_for('uploads', filename=data.post.author.photo_url) }}" alt="Аватар"></span>
							<span>{{ data.post.author.name }}</span>
						</a>
					{% else %}
						<a class="user-avatar" href="{{ url_for('user.profile_page', username=data.post.author.name) }}">
							<span><img width="33px" src="{{ data.post.author.gravatar(size=50) }}" alt="Аватар"></span>
							<span>{{ data.post.author.name }}</span>
						</a>
					{% endif %}
					{% if data.post.state == 'develop' %} <small class="dev anim-pulse">требуется доработать</small> {% endif %}
					
					{% if current_user == data.post.author %}
						<a class="btn btn-sm btn-outline" href="{{ url_for('post.editPost_page', id=data.post.id) }}">
							Редактировать
						</a>
					{% endif %}
					<small class="post-views mr-3">
						<span><i class="material-icons">visibility</i></span>
						<span class="Counter">{{ data.post.views }}</span>
					</small>
					<small class="post-rating">
						<span>
							<a {% if not data.rating_bool %} 
									href="{{ url_for('post.changeRating_request', id=data.post.id) }}"
								{% else %} 
									class="disabled"
								{% endif %}>
								<i class="material-icons">add</i>
							</a>
						</span>
						<span class="Counter">{{ data.post.rating }}</span>
					</small>
				</div>
				<div class="Box-body post-body">
					<small class="post-date">написан: {{ data.post.data_creation.strftime('%d.%m.%Y') }}</small>
					<h3>{{ data.post.title }}</h3>
					<hr>
					{% if data.tags %}
						{% for i in data.tags %}
							<a href="{{ url_for('post.tagPosts_page', id=i.tag.id) }}" class="Label Label--gray-darker mt-1 mr-1">{{ i.tag.name }} </a>
						{% endfor %}
					{% endif %}
					<hr>
					<div class="body">
						{% if data.post.t_contents_html %}
							{{ data.post.t_contents_html|safe }}
						{% endif %}
						<hr>
						{{ data.post.body_html|safe }}
					</div>
				</div>
			</article>
			{% if data.post.state != 'develop' %}
				{% if not current_user.is_anonymous %}
					<div class="Subhead">
						<div class="Subhead-heading">
							<h3>комментарии:</h3>
						</div>
						<div class="Subhead-actions">
							<a href="{{ url_for('comment.addComment_page', username=current_user.name, id=data.post.id) }}" 
								class="btn btn-sm btn-primary">Комментировать</a>
						</div>
					</div>
				{% else %}
					<div class="Subhead">
						<div class="Subhead-heading">
							<p>Войдите чтобы оставить комментарий</p>
						</div>
						<div class="Subhead-actions">
							<a href="{{ url_for('comment.addComment_page', username=current_user.name, id=data.post.id) }}" 
								class="btn btn-sm btn-primary">Комментировать</a>
						</div>
					</div>
				{% endif %}
				
				{% for comment in data.comments %}
					<ul>
						{% include '_comment_small.html' %}
					</ul>
				{% endfor %}
			{% endif %}
        </div>
    </section>
{% endblock %}