{% extends 'base.html' %}
{% from 'macros/_formhelpers.html' import render_field %}
{% block scripts %}
	{{ pagedown.include_pagedown() }}
{% endblock %}

<!-- :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::: -->

{% block content %}
	<section class="columns">
        <aside class="one-fourth column">
           {% include 'components/_nav_publications.html' %}
        </aside>
        <div class="three-fourths column">
			<article class="Box my-3 post">
				<div class="Box-header">
					{% if data.post.author.photo_url %}
						<a class="user-avatar" href="{{ url_for('user.profile_page', username=data.post.author.name) }}">
							<span><img width="33px" src="{{ url_for('uploads', filename=data.post.author.photo_url) }}" alt="Аватар"></span>
							<span>{{ data.post.author.name }}</span>
						</a>
					{% else %}
						<a class="user-avatar" href="{{ url_for('user.profile_page', username=data.post.author.name) }}">
							<span><img width="33px" src="{{ data.post.author.gravatar(size=50) }}" alt="Аватар"></span>
							<span>{{ data.post.author.name }}</span>
						</a>
					{% endif %}
					{% if current_user == data.post.author %}
						<a class="btn btn-sm btn-outline edit-btn" role="btn" href="{{ url_for('post.editPost_page', id=data.post.id) }}">
							Редактировать
						</a>
					{% endif %}
				</div>
				<div class="Box-body post-body">
					<small class="post-date">написан: {{ data.post.data_creation.strftime('%d.%m.%Y') }}</small> 
					<h3>{{ data.post.title }}</h3>
					<p>
						{% if data.post.body_html %}
							{{ data.post.body_html|safe }}
						{% else %}
							{{ data.post.text }}
						{% endif %}
					</p>
				</div>
			</article>
			{% if not current_user.is_anonymous %}
				<div class="Subhead">
					<div class="Subhead-heading">
						<h3>комментарии:</h3>
					</div>
					<div class="Subhead-actions">
						<a href="{{ url_for('comment.addComment_page', post_id=data.post.id) }}" class="btn btn-sm btn-primary">Добавить комментарий</a>
					</div>
				</div>
			{% else %}
				<div class="Subhead">
					<div class="Subhead-heading">
						<p>Войдите чтобы оставить комментарий</p>
					</div>
					<div class="Subhead-actions">
						<a href="{{ url_for('auth.login_page') }}" class="btn btn-sm">Войти</a>
					</div>
				</div>
			{% endif %}
			
			{% for comment in data.comments %}
				<ul>
					{% include 'comment/_comment_small.html' %}
				</ul>
			{% endfor %}
        </div>
    </section>
{% endblock %}